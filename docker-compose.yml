# ============================================
# 方式一：使用预构建镜像（推荐）
# ============================================
services:
  terminus-checkin:
    image: ghcr.io/zj145013/embycheckin:latest
    # Apple Silicon（M 系列）默认是 linux/arm64；当前预构建镜像仅提供 linux/amd64
    # 如需原生架构运行，请使用下方“方式二：本地构建镜像”
    platform: linux/amd64
    container_name: terminus-checkin
    restart: unless-stopped
    environment:
      # 首次登录需要填写手机号（带国际区号，如 +8613800138000）
      # 登录成功后可以删除或留空
      - PHONE_NUMBER=

      # AI 提供方选择：openai / gemini / claude
      - AI_PROVIDER=gemini

      # OpenAI（或 OpenAI 兼容接口）配置（AI_PROVIDER=openai）
      - OPENAI_BASE_URL=https://api.openai.com/v1
      - OPENAI_API_KEY=
      - OPENAI_MODEL=gpt-4o-mini
      - OPENAI_USE_STREAM=false
      # （可选）OpenAI 兼容网关：SSE 流式
      # - OPENAI_STREAM_INCLUDE_USAGE=true
      # （可选）部分模型参数（按需开启）
      # - OPENAI_REASONING_EFFORT=low
      # - OPENAI_VERBOSITY=medium

      # Gemini 官方 REST API 配置（AI_PROVIDER=gemini）
      # 如需使用第三方网关/镜像站，可将 GEMINI_BASE_URL 指向对应地址
      - GEMINI_BASE_URL=https://generativelanguage.googleapis.com/v1beta
      - GEMINI_API_KEY=
      - GEMINI_MODEL=gemini-2.5-flash
      - GEMINI_USE_STREAM=false
      # （可选）第三方网关常用：header 鉴权 / SSE 流式端点
      # - GEMINI_API_KEY_MODE=header # query/header/both（默认 header）
      # （可选）TLS/证书：企业代理/自签证书场景（建议优先配置 CA，而不是关闭校验）
      # - AI_CA_FILE=/app/certs/ca.pem
      # - GEMINI_CA_FILE=/app/certs/ca.pem
      # - GEMINI_SSL_VERIFY=true

      # Claude（Anthropic）配置（AI_PROVIDER=claude）
      - CLAUDE_BASE_URL=https://api.anthropic.com
      - CLAUDE_API_KEY=
      - CLAUDE_MODEL=claude-3-5-sonnet-20241022
      - CLAUDE_USE_STREAM=false
      # （可选）Claude 兼容网关：SSE 流式、请求头与 thinking
      # - CLAUDE_MAX_TOKENS=100
      # - CLAUDE_THINKING_ENABLED=false
      # - CLAUDE_THINKING_BUDGET_TOKENS=1024

      # 签到配置
      - CHECKIN_HOUR=9 # 每天签到时间（小时，24小时制）
      - CHECKIN_MINUTE=0 # 每天签到时间（分钟）
      - RUN_NOW=false # 启动时是否立即签到（测试用，正常运行设为 false）
      - SESSION_NAME=terminus_checkin

      # 时区
      - TZ=Asia/Shanghai
    volumes:
      # 持久化 session 和日志
      - ./sessions:/app/sessions
      - ./logs:/app/logs
      # 如需注入自定义 CA，请挂载证书文件，并配合 *_CA_FILE 使用
      # - ./certs/ca.pem:/app/certs/ca.pem:ro
    ports:
      # 首次部署/排障：配置器端口（容器配置缺失时会自动启动配置页面）
      # 默认仅绑定本机，避免 VPS 对公网暴露；如需远程访问请用 SSH 端口转发
      - "127.0.0.1:8765:8765"
    stdin_open: true
    tty: true

# ============================================
# 方式二：本地构建镜像
# 取消下面的注释，并注释掉上面的 image 行
# ============================================
#   terminus-checkin:
#     build: .
#     container_name: terminus-checkin
#     restart: unless-stopped
#     environment:
#       ... (同上)
