# EmbyCheckin - Telegram 自动签到
# 支持两种模式：新版调度器（推荐）或旧版单任务签到

services:
  # ============================================
  # 新版调度器（推荐）- 支持多任务、Web UI 管理
  # ============================================
  scheduler:
    image: ghcr.io/zj145013/embycheckin:latest
    platform: linux/amd64
    container_name: embycheckin-scheduler
    restart: always
    environment:
      # 数据库路径
      - DB_PATH=data/scheduler.db

      # Web 服务绑定
      - BIND_HOST=0.0.0.0
      - BIND_PORT=8765

      # Telegram API
      - API_ID=${API_ID:-2040}
      - API_HASH=${API_HASH:-b18441a1ff607e10a989891a5462e627}

      # AI 提供方选择：openai / gemini / claude
      - AI_PROVIDER=${AI_PROVIDER:-gemini}
      - AI_SSL_VERIFY=${AI_SSL_VERIFY:-true}

      # OpenAI 配置
      - OPENAI_BASE_URL=${OPENAI_BASE_URL:-https://api.openai.com/v1}
      - OPENAI_API_KEY=${OPENAI_API_KEY:-}
      - OPENAI_MODEL=${OPENAI_MODEL:-gpt-4o-mini}

      # Gemini 配置
      - GEMINI_BASE_URL=${GEMINI_BASE_URL:-https://generativelanguage.googleapis.com/v1beta}
      - GEMINI_API_KEY=${GEMINI_API_KEY:-}
      - GEMINI_MODEL=${GEMINI_MODEL:-gemini-2.5-flash}

      # Claude 配置
      - CLAUDE_BASE_URL=${CLAUDE_BASE_URL:-https://api.anthropic.com}
      - CLAUDE_API_KEY=${CLAUDE_API_KEY:-}
      - CLAUDE_MODEL=${CLAUDE_MODEL:-claude-3-5-sonnet-20241022}
      - CLAUDE_MAX_TOKENS=${CLAUDE_MAX_TOKENS:-200}

      # 时区
      - TZ=Asia/Shanghai
    volumes:
      # 持久化数据
      - ./data:/app/data
      - ./sessions:/app/sessions
      - ./logs:/app/logs
    ports:
      # Web UI 端口
      - "8765:8765"
    stdin_open: true
    tty: true

# ============================================
# 旧版单任务签到（如需使用，取消下面的注释）
# ============================================
#  terminus-checkin:
#    image: ghcr.io/zj145013/embycheckin:latest
#    platform: linux/amd64
#    container_name: terminus-checkin
#    restart: always
#    environment:
#      - PHONE_NUMBER=
#      - AI_PROVIDER=gemini
#      - GEMINI_BASE_URL=https://generativelanguage.googleapis.com/v1beta
#      - GEMINI_API_KEY=
#      - GEMINI_MODEL=gemini-2.5-flash
#      - CHECKIN_HOUR=9
#      - CHECKIN_MINUTE=0
#      - RUN_NOW=false
#      - TZ=Asia/Shanghai
#    volumes:
#      - ./sessions:/app/sessions
#      - ./logs:/app/logs
#    ports:
#      - "127.0.0.1:8765:8765"
#    stdin_open: true
#    tty: true
